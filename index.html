<html>
    <head>
        <script src="lib/vendor/gamepad.js" type="text/javascript"></script>

        <script src="lib/vendor/neon.js" type="text/javascript"></script>
        <script src="lib/vendor/NodeSupport.js" type="text/javascript"></script>
        <script src="lib/vendor/CustomEvent.js" type="text/javascript"></script>
        <script src="lib/vendor/CustomEventSupport.js" type="text/javascript"></script>
        <script src="lib/vendor/BubblingSupport.js" type="text/javascript"></script>
        <script src="lib/vendor/Widget.js" type="text/javascript"></script>

        <script src="lib/vendor/Chameleon.js" type="text/javascript"></script>

        <script src="lib/vendor/jquery-1.9.1.js" type="text/javascript"></script>

        <script src="lib/util.js" type="text/javascript"></script>
        <script src="lib/geometrySupport.js" type="text/javascript"></script>
        <script src="lib/entities/entity.js" type="text/javascript"></script>
        <script src="lib/entities/circle.js" type="text/javascript"></script>
        <script src="lib/entities/triangle.js" type="text/javascript"></script>
        <script src="lib/entities/rectangle.js" type="text/javascript"></script>
        <script src="lib/behaviors/behavior.js" type="text/javascript"></script>
        <script src="lib/behaviors/swinger.js" type="text/javascript"></script>
        <script src="lib/behaviors/rotator.js" type="text/javascript"></script>
        <script src="lib/behaviors/extensor.js" type="text/javascript"></script>
        <script src="lib/behaviors/pulsator.js" type="text/javascript"></script>
        <script src="lib/player.js" type="text/javascript"></script>
        <script src="lib/timeLapseSupport.js" type="text/javascript"></script>
        <script src="lib/game.js" type="text/javascript"></script>

        <script src="lib/tools/controls.js" type="text/javascript"></script>
        <script src="lib/tools/levelEditor.js" type="text/javascript"></script>
        <style>
            html, body {
              width : 100%;
              height : 100%;
              margin : 0;
              padding : 0;
            }
            canvas { border: 2px solid black; }
            #score-container {
              position : absolute;
              top : 0;
              left : 1000;
              width : 0;
              height : 0;
            }
            #score {
              position : absolute;
              top : 0;
              right : 0;
            }
            .slider .label { 
              display: block; 
            }
            .slider { 
              float: left; 
            }
        </style>
    </head>
    <body>
        <div id="score-container">
          <div id="score" style="position:absolute; top:0; right:0">0</div>
        </div>
        <canvas id="canvas"></canvas>
        <div id="controls"></div>

        <script type="text/javascript">
            window.DEBUG = false;
            var levelConfig = { enemies : [] };

            var initialConfig = {
                scrollSpeed : 7,
                playerSpeed : 18,
                dashSpeed : 10,
                dashDuration : 15,
                dashCooldown : 15,
                playerActionCooldown : 20
            };
            var game = new Game(initialConfig);
            game.load(levelConfig);
            game.run();

            window.game = game;

            var createSliderControl = function(target, settings) {
                (new Controls.Slider(settings)).
                    bindValue(game.settings, target).
                    render($('#controls'));
            };

            createSliderControl('scrollSpeed', {
                min : 3,
                max : 30,
                step : 0.5,
                value : initialConfig.scrollSpeed
            });

            createSliderControl('playerSpeed', {
                min : 15,
                max : 30,
                step : 0.5,
                value : initialConfig.playerSpeed
            });

            createSliderControl('dashSpeed', {
                min : 5,
                max : 20,
                step : 1,
                value : initialConfig.dashSpeed
            });

            createSliderControl('dashDuration', {
                min : 10,
                max : 40,
                step : 1,
                value : initialConfig.dashDuration
            });

            createSliderControl('dashCooldown', {
                min : 5,
                max : 30,
                step : 1,
                value : initialConfig.dashCooldown
            });

            var levelEditor = new LevelEditor();

            levelEditor.render($('#controls'));

            levelEditor.bind('level:load:success', function(event) {
                console.log("Data loaded:", event.level);
                game.load(event.level);
            });

            var urlParams = Util.getUrlParams();
            var level = 'default.json';
            if(urlParams.level) {
                level = urlParams.level.replace(/\/$/, ''); // Redirection from
                                                            // simpleHTTP server
            }
            levelEditor.load(level);

            game.bind('game:lose', function() {
                game.clear();
                levelEditor.load(level);
            });

            var levels = [
                'default.json',
                'stair.json',
                'circles.js'
            ];
            game.bind('game:tick', function(data) {
                // if(data.tick % 120 == 0) {
                //     levelEditor.load(levels[Math.floor(Math.random() * levels.length)])
                // }
            });

          </script>
    </body>
</html>
